"use strict";!function(e,t,n,a){function i(){if(E){var e=N.indexOf(E.name),t=I(N[e-1]);return t?t.name:C.name}return C.name}function o(e,n){if(q=!0,O=!1,N.push(e),E&&(C=E,L=t.getElementById(E.name)),E=I(e),k=t.getElementById(E.name),!E)throw new Error(e+" does not have a namespace, please use Navigator.on() function");if(T===E.name&&N.length>1&&(A=!0,N=[T]),C&&C.name===E.name)return void(q=!1);var a=k.querySelector(".content");null!==a&&0!==a.scrollTop&&(a.scrollTop=0),K(k,E,n),E.asynchronous||c()}function r(){null!==j&&(L.classList.remove("page-sliding"),L.classList.remove("left"),L.removeEventListener(j,r,!1)),L.classList.remove("app-active"),V(L,C),U(k,E),q=!1}function s(){null!==j&&(L.classList.remove("page-sliding"),L.classList.remove("right"),L.removeEventListener(j,s,!1)),L.classList.remove("app-active"),V(L,C),U(k,E),q=!1}function c(){return C===a||C.name===E.name?void(q=!1):(A?(k.classList.add("app-active"),j?(L.classList.add("page-sliding"),L.classList.add("right"),L.addEventListener(j,s,!1)):s()):(k.classList.add("app-active"),j?(L.classList.add("page-sliding"),L.classList.add("left"),L.addEventListener(j,r,!1)):r(L)),void(A=!1))}function l(){if(E.activity!==a&&E.activity.onReadyCallback!==a){var e=t.getElementById(E.name),n=location.hash.substr(2),i=S(E.route),o=G(n,i);E.activity.onReadyCallback({startTransition:c,getMessage:p},e,o)}}function u(){y(i())}function f(){O=!1}function p(){for(var e=H.length,t=e-1;t>=0;t--){var n=H[t];if(n.receiver===E.name)return H.splice(t,1),n.message}}function d(e,t){H.push({sender:E.name,receiver:e,message:t})}function v(n){if(R)throw new Error("The first page has already been instantiated");var a=I(n);if(!a)throw new Error(n+" does not have a namespace, please use Navigator.on() function");var i=t.getElementById(n);i.classList.contains("app-active")||i.classList.add("app-active"),e.location.hash==="#!"+n?o(n):e.location.hash="#!"+n,R=!0}function h(){return E.name}function g(){return C.name}function m(e,t,n){if("string"!=typeof e.page)throw new TypeError("page name must be a string");if(e.asynchronous===a&&(e.asynchronous=!1),"boolean"!=typeof e.asynchronous)throw new TypeError("asynchronous must be a boolean");if("function"!=typeof t)throw new TypeError("callback must be a function");B(e,t,n)}function y(t,n){if("string"!=typeof t)throw new TypeError("page name must be a string");if(!q){if(t===E.name&&console.error("The current page is already "+t),!I(t))throw new Error(t+" does not have a namespace, please use Navigator.on() function");var i=n===a?t:t+"/"+n;i=i.replace("//","/"),e.location.hash="#!"+i}}function b(t){if("object"!=typeof t)throw new TypeError("config must be an object");if("string"!=typeof t.defaultPage)throw new TypeError("default page is not set");T=t.defaultPage,t.templatePath!==a&&$(t.templatePath),e.Phonon&&e.Phonon.Panel&&(Q=!0),t.pageAnimations===!1&&(j=null),t.panels&&(t.panels.autoClose!==a&&(Q=t.panels.autoClose),t.panels.path&&(P=t.panels.path)),t.hammer!==a&&"string"==typeof t.hammer.path?Z(t.hammer.path,t.hammer.tapOptions):Z()}var w,E,C,k,L,T,P,x=function(){function e(){this._isCreated=!1}return e.prototype.isCreated=function(){return this._isCreated},e.prototype.onCreate=function(e){var t=this;this.onCreateCallback=function(n,a,i){t._isCreated=!0,e(n,a,i)}},e.prototype.onReady=function(e){this.onReadyCallback=function(t,n,a){e(t,n,a)}},e.prototype.onQuit=function(e){this.onQuitCallback=function(t){e(t)}},e.prototype.onHidden=function(e){this.onHidenCallback=function(t){e(t)}},e.prototype.onTransitionEnd=function(e){this.onTransitionEndCallback=function(){e()}},e}(),R=!1,M=[],N=[],q=!1,H=[],O=!1,A=!1,Q=!1,j="webkitAnimationEnd";n.animationEnd&&(j=n.animationEnd);var B=function(e,t,n){var i={name:e.page,template:e.template,asynchronous:e.asynchronous,route:n,callback:t};n===a&&(i.route=e.page),M.push(i)},I=function(e){var t,n=M.length-1;for(t=n;t>=0;t--){var i=M[t];if(i.name===e)return i}return a},G=function(e,t){var n=new RegExp(t.regex).exec(e);if(null===n)return!1;var a={};for(var i in t.groups)a[i]=n[t.groups[i]+1];return a},S=function(e){for(var t=new RegExp(":([^/.\\\\]+)","g"),n=e,a={},i=null,o=0;i=t.exec(e);)a[i[1]]=o++,n=n.replace(i[0],"([^/.\\\\]+)");return n+="$",{groups:a,regex:n}},_=function(){var t,n=e.location.hash.substr(2),a=M.length;for(t=a-1;t>=0;t--){var i=M[t];if(i.name===(n.substring(0,n.indexOf("/"))||n)){if(i.name!==i.route){var r=G(n,S(i.route));o(i.name,r)}else o(i.name);break}}},$=function(e){if("string"!=typeof e)throw new TypeError("path must be a string");var t=-1!==e.indexOf("/",e.length-"/".length);t||(e+="/"),w=e},D=function(e,t){var n=new XMLHttpRequest,i=w===a?e:w+e;n.open("GET",i+".html",!0),n.overrideMimeType("text/html; charset=utf-8"),n.onreadystatechange=function(){if(4==n.readyState){if(200!=n.status)return void console.error("The template file could not be loaded, please check that the file exists");t(n.responseText)}},n.send()},X=function(n){for(var o=null,r=n.target?n.target:n.toElement;r&&r!==t;r=r.parentNode){var s=r.getAttribute("data-navigation"),c=r.getAttribute("data-param");if(null!==s){"$previous-page"===s?(A=!0,o=i(),0!==o.indexOf("#!")&&(o="#!"+o)):o=0!==s.indexOf("#!")?"#!"+s:s,c&&(o=o+"/"+c);break}if(r.attributes.href!==a&&null!==r.attributes.href.value){var l=0!==r.attributes.href.value.indexOf("#!");if(!l){o=r.attributes.href.value;break}}}o&&(E.activity!==a&&E.activity.onQuitCallback!==a?W():e.location.hash=o),o=null},Y=function(){T===E.name||O||(O=!0,A=!0,E.activity!==a&&E.activity.onQuitCallback!==a?W():u())},z=function(){if(Q)if("function"==typeof require){if(!P)return void console.error("config.panels.cancelClose is true, but the AMD path to Phonon Panels is not set");require([P],function(e){var t=e.Panel?e.Panel:e;t().closeLastPanel()||Y()})}else{var e=n.Panel?n.Panel:n;e().closeLastPanel()||Y()}else Y()},F=function(e){for(var t=e.querySelectorAll("a, button"),n=t.length-1,a=n;a>=0;a--){var i=t[a],o=i.getAttribute("data-autotext");o&&("textContent"in i?i.textContent=C.name:i.innerText=C.name)}},J=function(e,t,n){t.callback!==a&&t.callback(t.activity),t.activity!==a&&t.activity.onCreateCallback!==a&&t.activity.onCreateCallback({runReady:l,getMessage:p},e,n),t.activity!==a&&t.activity.onReadyCallback!==a&&t.asynchronous===!1&&setTimeout(function(){t.activity.onReadyCallback({startTransition:c,getMessage:p},e,n)},50)},K=function(e,t,n){if(t!==a){var i=t.hasOwnProperty("activity");i?t.activity!==a&&t.activity.onReadyCallback!==a&&t.activity.onReadyCallback({startTransition:c,getMessage:p},e,n):(t.activity=new x,t.template!==a?D(t.template,function(a){e.innerHTML=a,F(e),J(e,t,n)}):(F(e),J(e,t,n)))}},U=function(e,t){t!==a&&t.activity!==a&&t.activity.onTransitionEndCallback!==a&&t.activity.onTransitionEndCallback()},V=function(e,t){t!==a&&t.activity!==a&&t.activity.onHidenCallback!==a&&t.activity.onHidenCallback(e)},W=function(){E.activity.onQuitCallback({quit:u,cancel:f})},Z=function(e,n){var a=n||{};if("undefined"!=typeof Hammer){var i=new Hammer(t.body).on("tap",X,!1);i.get("tap").set(a)}else"function"==typeof require?require([e],function(e){if("undefined"!=typeof e){var n=new e(t.body).on("tap",X,!1);n.get("tap").set(a)}else t.addEventListener("click",X,!1)}):t.addEventListener("click",X,!1)},et={};if(et.setMessage=d,et.start=v,et.getCurrentPage=h,et.getPreviousPage=g,et.on=m,et.changePage=y,et.init=b,!("onhashchange"in e))throw new Error("Your browser does not support the hashchange event");e.addEventListener("hashchange",_),t.addEventListener("backbutton",z),n.Navigator=function(e){return"object"==typeof e&&b(e),et},e.Phonon=n,"function"==typeof define&&define.amd?define(function(){return n.returnGlobalNamespace===!0?n:n.Navigator}):"object"==typeof module&&module.exports&&(module.exports=n.returnGlobalNamespace===!0?n:n.Navigator)}(window,document,window.Phonon||{});